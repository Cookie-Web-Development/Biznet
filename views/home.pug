doctype html
html(lang=lang)
    include partials/_head.pug
    body
        include partials/_header.pug
        main 
            if (featured_list.length > 0)
                h2=langData.main.best_seller[lang]
                if (featured_list.length == 1)
                    section#product_carousel
                        article(data-product-card='medium' data-carousel class='current')
                            a(class="image_container", href=`/product/${featured_list[0]._id}`)
                                    img(src='/public/img/products-images/' + featured_list[0].listing[0].images[0])
                            div.text_container   
                                p.text_container_header 
                                    span(href='')=featured_list[0].category_name[lang]
                                    span=" / " 
                                    span(href='')=featured_list[0].brand_name
                                h3
                                    a(href=`/product/${featured_list[0]._id}`)=featured_list[0].name[lang]
                                div.product_card_price_tag
                                    a(class='price_sell', href=`/product/${featured_list[0]._id}`)=featured_list[0].listing[0].format_price_discounted
                                    if(featured_list[0].listing[0].discount_percent > 0)
                                        p.price_discount
                                            span.price_before #{featured_list[0].listing[0].format_price} 
                                            span.discount_percent #{Math.round(featured_list[0].listing[0].discount_percent * 100)}%
                                p.product_card_description=featured_list[0].description[lang]
                                ul.product_card_tags
                                    each tag in featured_list[0].tag_id
                                        li
                                            a(href='')=tag 
                else
                    section#product_carousel
                        div(id='carousel_prev' class='carousel_btn')
                            i(class="fa-solid fa-chevron-left fa-xl")
                        each item in featured_list  
                            article(data-product-card='medium' data-carousel)
                                a(class="image_container", href=`/product/${item._id}`)
                                    img(src='/public/img/products-images/' + item.listing[0].images[0])
                                div.text_container   
                                    p(class="text_container_header") 
                                        span(href=`/catalog?category=${item.category_name[lang]}`)=item.category_name[lang]
                                        span=" / " 
                                        span(href=`/catalog?brand=${item.brand_name}`)=item.brand_name
                                    h3
                                        a(href=`/product/${item._id}`)=item.name[lang]
                                    a(class='product_card_price_tag', href=`/product/${item._id}`)
                                        p.price_sell=item.listing[0].format_price_discounted
                                        if(item.listing[0].discount_percent > 0)
                                            p.price_discount
                                                span.price_before #{item.listing[0].format_price} 
                                                span.discount_percent #{Math.round(item.listing[0].discount_percent * 100)}%
                                    p.product_card_description=item.description[lang]
                                    ul.product_card_tags
                                        each tag in item.tag_array
                                            li
                                                span(href=`/product?selected_tags=${tag.name[lang]}`)=tag.name[lang] 
                        div(id='carousel_next' class='carousel_btn')
                            i(class="fa-solid fa-chevron-right fa-xl")
                        div#carousel_dot_container
                            each item in featured_list 
                                div.carousel_dot
            - let api_obj_argument;
            if (discount_list.length > 0)
                - api_obj_argument = {header_section: 'deals_day', api_response: discount_list}
                include include/drag_display.pug
        footer

        script.
            /*###########
            Carousel Code
            #############*/
            let carouselCards = document.querySelectorAll('[data-carousel]');
            if (carouselCards.length > 1) { 
                let carousel_next = document.getElementById('carousel_next');
                let carousel_prev = document.getElementById('carousel_prev');
                let carousel_dot = document.querySelectorAll('.carousel_dot');

                let cardIndex = 0;
                carouselCurrent(cardIndex);
                
                carousel_next.addEventListener('click', () => {
                    let newIndex = cardIndex + 1;
                    if (newIndex >= carouselCards.length) {
                        newIndex = 0
                    };

                    carouselAnimToggle(carouselCards, cardIndex, newIndex, 'anim_to_left');
                    
                    cardIndex = newIndex;
                    carouselCurrent(cardIndex);
                });

                carousel_prev.addEventListener('click', () => {
                    let newIndex = cardIndex - 1;
                    if (newIndex < 0) {
                        newIndex = carouselCards.length - 1
                    }

                    carouselAnimToggle(carouselCards, cardIndex, newIndex, 'anim_to_right');

                    cardIndex = newIndex;
                    carouselCurrent(cardIndex);
                })

                //Carousel dots
                let dotArr = Array.from(carousel_dot);

                carousel_dot.forEach(dot => {
                    let dotIndex = dotArr.indexOf(dot);

                    dot.addEventListener('click', () => {
                        carouselAnimToggle(carouselCards, cardIndex, dotIndex, 'anim_to_top');
                        cardIndex = dotIndex;
                        carouselCurrent(cardIndex);
                    })
                });

                // FUNCTIONS
                function carouselCurrent(index) {
                    carouselCards.forEach(card => {
                        card.classList.remove('current');
                        card.classList.remove('next');
                    });

                    carousel_dot.forEach(dot => {
                        dot.classList.remove('current')
                    })
                    carouselCards[index].classList.add('current');
                    carousel_dot[index].classList.add('current')
                };

                function carouselAnimToggle(arr, index, new_index, animation_name) {
                    if (document.getElementsByClassName('animation')) {
                        arr.forEach(card => {
                            card.classList.remove('animation')
                        })};

                    arr.forEach(card => {
                        card.classList.remove('anim_to_left');
                        card.classList.remove('anim_to_right');
                        card.classList.remove('anim_to_top');
                    })
                    
                    arr[new_index].classList.add('next');
                    arr[index].classList.add(animation_name);
                    arr[index].classList.add('animation');
                    arr[index].addEventListener('animationend', () => {
                        arr[index].classList.remove('animation');
                    })
                };
            };
